<!DOCTYPE HTML><html lang="zh-hans"><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>WeChat Pay</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content="
  
"name="description"><meta content="GitBook 3.2.3"name="generator"><meta content="QuickApp.cn"name="author"><link href="../../gitbook/style.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-search-pro/search.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-highlight-hap/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css"rel="stylesheet"><link href="../../styles/website.css"rel="stylesheet"><meta content="no-cache"http-equiv="Pragma"/><meta content="no-cache"http-equiv="Cache-Control"/><meta content="0"http-equiv="Expires"/><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="alipay.en.html"rel="next"/><link href="alipay.en.html"rel="next"/></head><body><header class="doc-header"><a href="javascript:;"class="btn doc-menu-toggle"aria-label=""><i class="fa fa-bars"aria-hidden="true"></i></a><div class="doc-logo"><a target="_blank"style="font-size:150%"title="quickapp">QuickApp</a></div><div class="doc-nav"><a href="../../">Tutorial</a> <a href="../../tools/toolkit-tools.en.html">Tools</a> <a href="../../framework/index.en.html">Framework</a> <a href="../../widgets/common-events.en.html">Widgets</a> <a href="../index.en.html"class="current">Features</a></div><div class="doc-search-bar"><div id="book-search-input"><i class="fa fa-search icon-search"aria-hidden="true"></i> <input placeholder="关键字搜索"type="text"></div></div></header><div class="doc-container"><nav class="doc-menu"role="navigation"><ul class="summary"><li class="open chapter"data-level="2.1.3.1"><a href="javascript:;">Basic functions <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.1.1"data-path="../system/app.en.html"><a href="../system/app.en.html">App context</a></li><li class="open chapter"data-level="2.1.3.1.2"data-path="../system/log.en.html"><a href="../system/log.en.html">Log printing</a></li><li class="open chapter"data-level="2.1.3.1.3"data-path="../system/router.en.html"><a href="../system/router.en.html">Page routing</a></li></ul></li><li class="open chapter"data-level="2.1.3.2"><a href="javascript:;">Interface interaction <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.2.1"data-path="../system/share.en.html"><a href="../system/share.en.html">Sharing</a></li><li class="open chapter"data-level="2.1.3.2.2"data-path="../system/prompt.en.html"><a href="../system/prompt.en.html">Pop-up window</a></li><li class="open chapter"data-level="2.1.3.2.3"data-path="../system/webview.en.html"><a href="../system/webview.en.html">Open web page</a></li><li class="open chapter"data-level="2.1.3.2.4"data-path="../system/notification.en.html"><a href="../system/notification.en.html">Notification message</a></li><li class="open chapter"data-level="2.1.3.2.5"data-path="../system/vibrator.en.html"><a href="../system/vibrator.en.html">Vibrate</a></li></ul></li><li class="open chapter"data-level="2.1.3.3"><a href="javascript:;">Network access <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.3.1"data-path="../system/request.en.html"><a href="../system/request.en.html">Uploading and downloading</a></li><li class="open chapter"data-level="2.1.3.3.2"data-path="../system/fetch.en.html"><a href="../system/fetch.en.html">Data request</a></li></ul></li><li class="open chapter"data-level="2.1.3.4"><a href="javascript:;">File data <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.4.1"data-path="../system/storage.en.html"><a href="../system/storage.en.html">Data storage</a></li><li class="open chapter"data-level="2.1.3.4.2"data-path="../system/file.en.html"><a href="../system/file.en.html">File storage</a></li></ul></li><li class="open chapter"data-level="2.1.3.5"><a href="javascript:;">System capabilities <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.5.1"data-path="../system/barcode.en.html"><a href="../system/barcode.en.html">QR codes</a></li><li class="open chapter"data-level="2.1.3.5.2"data-path="../system/sensor.en.html"><a href="../system/sensor.en.html">Sensors</a></li><li class="open chapter"data-level="2.1.3.5.3"data-path="../system/clipboard.en.html"><a href="../system/clipboard.en.html">Clipboard</a></li><li class="open chapter"data-level="2.1.3.5.4"data-path="../system/geolocation.en.html"><a href="../system/geolocation.en.html">Geographical location</a></li><li class="open chapter"data-level="2.1.3.5.5"data-path="../system/shortcut.en.html"><a href="../system/shortcut.en.html">Home screen icons</a></li><li class="open chapter"data-level="2.1.3.5.6"data-path="../system/calendar.en.html"><a href="../system/calendar.en.html">Calendar events</a></li><li class="open chapter"data-level="2.1.3.5.7"data-path="../system/network.en.html"><a href="../system/network.en.html">Network status</a></li><li class="open chapter"data-level="2.1.3.5.8"data-path="../system/device.en.html"><a href="../system/device.en.html">Device information</a></li></ul></li><li class="open chapter"data-level="2.1.3.6"><a href="javascript:;">Graphics <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.6.1"data-path="../system/media.en.html"><a href="../system/media.en.html">Multimedia</a></li></ul></li><li class="open chapter"data-level="2.1.3.7"><a href="javascript:;">Vendor services <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="2.1.3.7.1"data-path="push.en.html"><a href="push.en.html">Push</a></li><li class="open chapter"data-level="2.1.3.7.2"data-path="pay.en.html"><a href="pay.en.html">Payments</a></li></ul></li><li class="open open chapter"data-level="2.1.3.8"><a href="javascript:;">Third-party services <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open open chapter active"data-level="2.1.3.8.1"data-path="wxpay.en.html"><a href="wxpay.en.html">WeChat Pay</a></li><li class="open chapter"data-level="2.1.3.8.2"data-path="alipay.en.html"><a href="alipay.en.html">Alipay</a></li><li class="open chapter"data-level="2.1.3.8.3"data-path="share.en.html"><a href="share.en.html">Sharing to a third party platform</a></li></ul></li></ul></nav><div class="doc-content"><div class="doc-content-inner"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><a href="#wechat-pay-101"id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="wechat-pay-101"><a href="#wechat-pay-101"class="anchor-navigation-ex-anchor"name="wechat-pay-101"><i class="fa fa-link"aria-hidden="true"></i></a>WeChat Pay <code>101+</code></h1><h2 id="interface-declaration"><a href="#interface-declaration"class="anchor-navigation-ex-anchor"name="interface-declaration"><i class="fa fa-link"aria-hidden="true"></i></a>Interface declaration</h2><pre><code>{"name": "service.wxpay", "params": {"package": "com.your.package", "sign": "abcdefg", "url": "http://your.domain/page"}}
</code></pre><h2 id="import-module"><a href="#import-module"class="anchor-navigation-ex-anchor"name="import-module"><i class="fa fa-link"aria-hidden="true"></i></a>Import module</h2><pre><code>import wxpay from '@service.wxpay' or var wxpay = require("@service.wxpay")
</code></pre><h2 id="interface-definition"><a href="#interface-definition"class="anchor-navigation-ex-anchor"name="interface-definition"><i class="fa fa-link"aria-hidden="true"></i></a>Interface definition</h2><h3 id="wxpaygettype"><a href="#wxpaygettype"class="anchor-navigation-ex-anchor"name="wxpaygettype"><i class="fa fa-link"aria-hidden="true"></i></a>wxpay.getType()</h3><p>Get the currently available WeChat Pay call method</p><h4 id="parameters"><a href="#parameters"class="anchor-navigation-ex-anchor"name="parameters"><i class="fa fa-link"aria-hidden="true"></i></a>Parameters:</h4><p>None</p><h4 id="return-value："><a href="#return-value："class="anchor-navigation-ex-anchor"name="return-value："><i class="fa fa-link"aria-hidden="true"></i></a>Return value：</h4><table><thead><tr><th>Return value</th><th>Notes</th></tr></thead><tbody><tr><td>none</td><td>WeChat hasn't been installed</td></tr><tr><td>APP</td><td>WeChat app call method, when the service is placing the order to WeChat, the trade_type needs the app, see <a href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_1"target="_blank">WeChat Pay (app)</a></td></tr><tr><td>MWEB</td><td>WeChat web page call method, when the server is placing the order to WeChat, trade_type needs MWEB, see <a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=9_20"target="_blank">WeChat Pay (web)</a></td></tr></tbody></table><h3 id="wxpaypayobject"><a href="#wxpaypayobject"class="anchor-navigation-ex-anchor"name="wxpaypayobject"><i class="fa fa-link"aria-hidden="true"></i></a>wxpay.pay(OBJECT)</h3><p>Launch WeChat Pay</p><h4 id="parameters_1"><a href="#parameters_1"class="anchor-navigation-ex-anchor"name="parameters_1"><i class="fa fa-link"aria-hidden="true"></i></a>Parameters:</h4><table><thead><tr><th>Parameter name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>prepayid</td><td>String</td><td>Yes</td><td>The prepaid order ID generated by the WeChat server, see <a href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_1"target="_blank">WeChat Pay (app)</a> and <a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=9_20"target="_blank">WeChat Pay (web)</a></td></tr><tr><td>extra</td><td>Object</td><td>Yes</td><td>The current payment method, must fill in extra order information, for specifics, see the extra parameters description below</td></tr><tr><td>success</td><td>Function</td><td>No</td><td>The callback function after the user has paid. With the app method, the callback happens after the user has completed the payment, with the web page method, the callback happens after the order has been submitted to the WeChat app</td></tr><tr><td>fail</td><td>Function</td><td>No</td><td>Couldn't return callback</td></tr><tr><td>cancel</td><td>Function</td><td>No</td><td>Cancel callback</td></tr></tbody></table><h4 id="extra-parameters"><a href="#extra-parameters"class="anchor-navigation-ex-anchor"name="extra-parameters"><i class="fa fa-link"aria-hidden="true"></i></a>Extra parameters:</h4><h5 id="app-payments"><a href="#app-payments"class="anchor-navigation-ex-anchor"name="app-payments"><i class="fa fa-link"aria-hidden="true"></i></a>App payments</h5><table><thead><tr><th>Field name</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>app_id</td><td>Yes</td><td>The app_id in the WeChat Pay order</td></tr><tr><td>partner_id</td><td>Yes</td><td>The partner_id in the WeChat Pay order</td></tr><tr><td>package_value</td><td>Yes</td><td>The package_value in the WeChat Pay order</td></tr><tr><td>nonce_str</td><td>Yes</td><td>The nonce_str in the WeChat Pay order</td></tr><tr><td>time_stamp</td><td>Yes</td><td>The time_stamp in the WeChat Pay order</td></tr><tr><td>order_sign</td><td>Yes</td><td>The order_sign in the WeChat Pay order</td></tr></tbody></table><h5 id="web-payments"><a href="#web-payments"class="anchor-navigation-ex-anchor"name="web-payments"><i class="fa fa-link"aria-hidden="true"></i></a>Web payments</h5><table><thead><tr><th>Field name</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>mweb_url</td><td>No</td><td>When a payment action has been completed by WeChat server, the MWEB_URL in the result will be used as the"Get" parameter to be passed to the WeChat H5 payment webpage.</td></tr><tr><td>custome_key</td><td>No</td><td>Other custom key values, you can add other key names and values you think you need according to your own requirements</td></tr></tbody></table><h4 id="success-return-value"><a href="#success-return-value"class="anchor-navigation-ex-anchor"name="success-return-value"><i class="fa fa-link"aria-hidden="true"></i></a>Success return value:</h4><table><thead><tr><th>Parameter name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>prepayid</td><td>String</td><td>Only appears in the app payment method, the prepay ID of the WeChat Pay order</td></tr><tr><td>final_url</td><td>String</td><td>Only appears in the web page method, after joining the parameters, it will be used to open the web page URL</td></tr></tbody></table><h4 id="fail-return-error-code"><a href="#fail-return-error-code"class="anchor-navigation-ex-anchor"name="fail-return-error-code"><i class="fa fa-link"aria-hidden="true"></i></a>Fail return error code:</h4><table><thead><tr><th>Error code</th><th>Description</th></tr></thead><tbody><tr><td>900</td><td>Error in the app signature configured in the manifest.json, can't be parsed</td></tr><tr><td>901</td><td>Error in the package name configured in the manifest.json</td></tr><tr><td>1000</td><td>WeChat hasn't been installed</td></tr><tr><td>1001</td><td>Used for when the URL configuration of the WeChat web page payment method can't be found</td></tr><tr><td>2001</td><td>The order has already been submitted to WeChat, but WeChat returned an error, possible reasons are: signature error, unregistered appID, incorrect project appID set, registered appID and set appID mismatch, other abnormalities etc.</td></tr></tbody></table><h4 id="example"><a href="#example"class="anchor-navigation-ex-anchor"name="example"><i class="fa fa-link"aria-hidden="true"></i></a>Example</h4><pre><code>useWxpay: function() {
    var payType = wxpay.getType();
    if (payType == 'APP') {
        wxpay.pay({
            //Prepay ID of WeChat app payment
            prepayid: 'your order prepayid,eg: wx20170101abcdef1234567890',
            extra: {
                app_id: 'your app_id',
                partner_id: 'your partner_id',
                package_value: 'your package_value',
                nonce_str: 'your nonce_str',
                time_stamp: 'your time_stamp',
                order_sign: 'your order sign'
            },
            fail: function(data, code) {
                console.log("WX PAY failed, code=" + code);
            },
            cancel: function(data) {
                console.log("WX PAY cancelled by user");
            },
            success: function(data) {
                console.log("WX PAY success");
            }
        })
    } else if (payType == 'MWEB') {
        wxpay.pay({
            //Prepay ID of the WeChat web page payment
            prepayid: 'your order prepayid,eg: wx20170101abcdef1234567890',
            extra: {
                //Custom parameters transmitted to the pay page, set up as required, after it has been urlEncode it will be joined to the end of the configured URL
                mweb_url: 'https://wx.tenpay.com/cgi-bin/mmpayweb-bin',
                customeKey1: 'customeValue1',
                customeKey2: 'customeValue2'
            },
            fail: function(data, code) {
                console.log("WX H5 PAY handling fail, code=" + code);
            },
            cancel: function(data) {
                console.log("WX H5 PAY handling cancel");
            },
            success: function(data) {
                //In the H5 method, the pay success callback only signifies that the order has been submitted to WeChat and doesn't mean that the payment has completed
                console.log("WX H5 PAY handling success");
            }
        })
    } else {
        console.log("wx pay not avaliable.");
    }
}
</code></pre><h2 id="access-description"><a href="#access-description"class="anchor-navigation-ex-anchor"name="access-description"><i class="fa fa-link"aria-hidden="true"></i></a>Access description</h2><h3 id="method-selection"><a href="#method-selection"class="anchor-navigation-ex-anchor"name="method-selection"><i class="fa fa-link"aria-hidden="true"></i></a>Method selection</h3><p>The app payment method is only supported on some phone systems, whereas the web page method is supported by all phone systems. However, the the web page payment produces a pay callback after the order has been submitted to WeChat, unlike like the app method, which does it when the payment produces a result. We recommend that the CP supports both of these access payment methods.</p><h3 id="app-payment-access"><a href="#app-payment-access"class="anchor-navigation-ex-anchor"name="app-payment-access"><i class="fa fa-link"aria-hidden="true"></i></a>App payment access</h3><ol><li>See <a href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_1"target="_blank">WeChat Pay (app)</a> to complete WeChat Pay server access</li><li>Add a new app to the WeChat Pay background. This app must have a new package name and can't conflict with your own app's package name. It doesn't need to be released, but you must submit an APK to register the app signature corresponding to the new package name</li><li>Add the values of the newly registered app package name and app signature to the 'package' and 'sign' fields of the manifest.json WeChat Pay interface declaration respectively (you can get the signature value by using <a href="AppSignGetter.apk">this tool</a> after installing the newly registered APK), as is shown in the interface declaration</li></ol><h3 id="web-page-payment-access"><a href="#web-page-payment-access"class="anchor-navigation-ex-anchor"name="web-page-payment-access"><i class="fa fa-link"aria-hidden="true"></i></a>Web page payment access</h3><ol><li>See <a href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=9_20"target="_blank">WeChat Pay (web)</a> to complete WeChat Pay server access</li><li>Provide an H5 page that launches payment to the server, this page reads the imported MWEB_URL and will then automatically skip to MWEB_URL</li><li>Write the URL corresponding to the payment H5 page from step 2 into the URL field of the manifest.json WeChat Pay interface declaration, as shown in the interface declaration</li></ol></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> 条匹配 "<span class="search-query"></span>" 的结果</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">没有搜索到与 "<span class="search-query"></span>" 相关的内容</h1></div></div></div></div></div><a href="alipay.en.html"class="navigation navigation-next navigation-unique"aria-label="Next page: Alipay"><i class="fa fa-angle-right"></i></a></div></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/gitbook-plugin-hap-util/plugin.js"></script><script src="../../gitbook/gitbook-plugin-nocache/nocache.js"></script><script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script><script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script><script>gitbook.page.hasChanged({page:{title:"WeChat Pay",level:"2.1.3.8.1",depth:4,next:{title:"Alipay",level:"2.1.3.8.2",depth:4,path:"features/service/alipay.en.md",ref:"features/service/alipay.en.md",articles:[]},previous:{title:"Third-party services",level:"2.1.3.8",depth:3,ref:"",articles:[{title:"WeChat Pay",level:"2.1.3.8.1",depth:4,path:"features/service/wxpay.en.md",ref:"features/service/wxpay.en.md",articles:[]},{title:"Alipay",level:"2.1.3.8.2",depth:4,path:"features/service/alipay.en.md",ref:"features/service/alipay.en.md",articles:[]},{title:"Sharing to a third party platform",level:"2.1.3.8.3",depth:4,path:"features/service/share.en.md",ref:"features/service/share.en.md",articles:[]}]},dir:"ltr"},config:{plugins:["html-minifier","-sharing","-fontsettings","hap-util","favicon","theme-default","nocache","-lunr","-search","search-pro","-highlight","highlight-hap","anchor-navigation-ex"],styles:{website:"styles/website.css"},pluginsConfig:{favicon:{shortcut:"",bookmark:""},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!0,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},"anchor-navigation-ex":{associatedWithSummary:!1,float:{floatIcon:"fa fa-navicon",level1Icon:"",level2Icon:"",level3Icon:"",showLevelIcon:!1},mode:"",multipleH1:!0,pageTop:{level1Icon:"",level2Icon:"",level3Icon:"",showLevelIcon:!1},printLog:!1,showGoTop:!0,showLevel:!1},"hap-util":{},nocache:{},"search-pro":{},"highlight-hap":{},"theme-default":{showLevel:!1,styles:{ebook:"styles/ebook.css",epub:"styles/epub.css",mobi:"styles/mobi.css",pdf:"styles/pdf.css",print:"styles/print.css",website:"styles/website.css"}}},theme:"default",author:"QuickApp.cn",pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{},version:"{{datetime}}",title:"快应用开发文档",language:"zh-hans",gitbook:"3.2.3",description:"快应用的开发文档，供快应用开发者学习和参考"},file:{path:"features/service/wxpay.en.md",mtime:"2020-09-23T10:05:42.000Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2021-08-09T14:48:39.986Z"},basePath:"../..",book:{language:""}}),function(){var e=location.pathname.split("/")[1];e!=(sessionStorage.getItem("indexTab")||"")&&sessionStorage.setItem("mst",0),~location.pathname.indexOf(".html")||sessionStorage.setItem("mst",0),sessionStorage.setItem("indexTab",e);var t=$(".doc-menu"),s=$(".summary");if(!(t.height()>s.height()&&0!==s.height())){t.scroll(function(){sessionStorage.setItem("mst",t.scrollTop())});var a=sessionStorage.getItem("mst")||0;t.scrollTop(a),$("ul.summary li").each(function(){var e=$(this);10<e.data("level").length&&(e.hasClass("active")?e.parent().parent().attr("class","open chapter cur"):e.parent().parent().siblings().each(function(){var e=$(this);!e.hasClass("cur")&&e.hasClass("open chapter")&&e.attr("class","chapter")}))})}}()</script></body></html>